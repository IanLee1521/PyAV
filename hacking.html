<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Hacking on PyAV &mdash; PyAV 0.2.3 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.png"/>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="PyAV 0.2.3 documentation" href="index.html" />
    <link rel="next" title="Wrapped C Types and Functions" href="includes.html" />
    <link rel="prev" title="API Reference" href="api.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="includes.html" title="Wrapped C Types and Functions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="api.html" title="API Reference"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">PyAV 0.2.3 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="hacking-on-pyav">
<h1>Hacking on PyAV<a class="headerlink" href="#hacking-on-pyav" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-real-goal">
<h2>The Real Goal<a class="headerlink" href="#the-real-goal" title="Permalink to this headline">¶</a></h2>
<p>The goal here is to not only wrap ffmpeg in Python and provide nearly complete
access to the library, but to make it easier to use without the need to
understand the full library.</p>
<p>For example:</p>
<ul class="simple">
<li>we don&#8217;t need to mimick the underlying project structure as much as we do;</li>
<li>we shouldn&#8217;t be exposing audio attributes on a video codec, and vise-versa;</li>
<li>the concept of packets could be abtracted away to yielding frames from streams;</li>
<li>time should be a real number, instead of a rational;</li>
<li>...</li>
</ul>
</div>
<div class="section" id="ffmpeg-vs-libav">
<h2>FFmpeg vs Libav<a class="headerlink" href="#ffmpeg-vs-libav" title="Permalink to this headline">¶</a></h2>
<p>We test compile and link tiny executables to determine what functions and
structure members are availible, and some very small shim headers to smooth
out the differences.</p>
<p>We <a class="reference external" href="https://travis-ci.org/mikeboers/PyAV">continually test</a> multiple versions
of FFmpeg/Libav, as well as Linux/OS X, and Python 2/3.</p>
<p>You can use the same build system as Travis for local development:</p>
<div class="highlight-python"><div class="highlight"><pre>source scripts/activate.sh ffmpeg 2.7
./scripts/build-deps
make
nosetests
</pre></div>
</div>
</div>
<div class="section" id="library-detection">
<h2>Library Detection<a class="headerlink" href="#library-detection" title="Permalink to this headline">¶</a></h2>
<p>Macros will be defined for the libraries we link against. In particular, you
will have either <tt class="docutils literal"><span class="pre">PYAV_HAVE_LIBSWRESAMPLE</span></tt> or <tt class="docutils literal"><span class="pre">PYAV_HAVE_LIBAVRESAMPLE</span></tt>.</p>
</div>
<div class="section" id="function-detection">
<h2>Function Detection<a class="headerlink" href="#function-detection" title="Permalink to this headline">¶</a></h2>
<p>Macros will be defined for a few functions that are only in one of FFmpeg or
LibAV. For example, there may be a <tt class="docutils literal"><span class="pre">PYAV_HAVE_AVFORMAT_CLOSE_INPUT</span></tt> macro.
See the <tt class="docutils literal"><span class="pre">reflect</span></tt> command in <tt class="docutils literal"><span class="pre">setup.py</span></tt> to add more.</p>
</div>
<div class="section" id="struct-member-detection">
<h2>Struct Member Detection<a class="headerlink" href="#struct-member-detection" title="Permalink to this headline">¶</a></h2>
<p>Macros will be defined for structure members that are not garunteed to exist
(usually because LibAV deprecated and removed them, while FFmpeg did not).
For example, there may be a <tt class="docutils literal"><span class="pre">PYAV_HAVE_AVFRAME__MB_TYPE</span></tt> macro if the
<tt class="docutils literal"><span class="pre">AVFrame.mb_type</span></tt> member exists.</p>
</div>
<div class="section" id="class-relationships">
<h2>Class Relationships<a class="headerlink" href="#class-relationships" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">Context.streams</span></tt> is a list of <tt class="docutils literal"><span class="pre">Stream</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">Packet.stream</span></tt> is the <tt class="docutils literal"><span class="pre">Stream</span></tt> that it is from.</li>
<li><tt class="docutils literal"><span class="pre">Frame</span></tt> has no relationships in Python space.</li>
</ul>
</div>
<div class="section" id="time-in-libraries">
<h2>Time in Libraries<a class="headerlink" href="#time-in-libraries" title="Permalink to this headline">¶</a></h2>
<p>Time is usually represented as fractions; there is often a <tt class="docutils literal"><span class="pre">uint64_t</span> <span class="pre">pts</span></tt> or
<tt class="docutils literal"><span class="pre">dts</span></tt> variable in <cite>AVRational time_base</cite> units.</p>
<p>Both <tt class="docutils literal"><span class="pre">AVStream</span></tt> and <tt class="docutils literal"><span class="pre">AVCodecContext</span></tt> have a time_base. While encoding, they
are for the <tt class="docutils literal"><span class="pre">AVPacket</span></tt> and <tt class="docutils literal"><span class="pre">AVFrame</span></tt> times respectively. However, while
decoding all times are in <tt class="docutils literal"><span class="pre">AVStream.time_base</span></tt>.</p>
<p>When there is no time_base (such as on <tt class="docutils literal"><span class="pre">AVFormatContext</span></tt>), there is an
implicit time_base of <tt class="docutils literal"><span class="pre">1/AV_TIME_BASE</span></tt>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo-250.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Hacking on PyAV</a><ul>
<li><a class="reference internal" href="#the-real-goal">The Real Goal</a></li>
<li><a class="reference internal" href="#ffmpeg-vs-libav">FFmpeg vs Libav</a></li>
<li><a class="reference internal" href="#library-detection">Library Detection</a></li>
<li><a class="reference internal" href="#function-detection">Function Detection</a></li>
<li><a class="reference internal" href="#struct-member-detection">Struct Member Detection</a></li>
<li><a class="reference internal" href="#class-relationships">Class Relationships</a></li>
<li><a class="reference internal" href="#time-in-libraries">Time in Libraries</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="api.html"
                        title="previous chapter">API Reference</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="includes.html"
                        title="next chapter">Wrapped C Types and Functions</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/hacking.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="includes.html" title="Wrapped C Types and Functions"
             >next</a> |</li>
        <li class="right" >
          <a href="api.html" title="API Reference"
             >previous</a> |</li>
        <li><a href="index.html">PyAV 0.2.3 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Mike Boers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>